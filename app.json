[{"name": "app.py", "content": "from shiny import App, ui, reactive\nimport numpy as np\nfrom fcn_thelen_opt import thelen_muscle_opt\nfrom fcn_thelen_muscle import thelen_muscle\n\n# Define the UI using page_sidebar (which manages both sidebar and main panel)\napp_ui = ui.page_sidebar(\n    ui.input_slider(\"force\", \"Force\", 0, 100, 50),\n    ui.input_slider(\"frequency\", \"Frequency\", 1, 10, 5),\n    ui.input_slider(\"excursion\", \"Excursion\", 1, 100, 50),\n    ui.input_slider(\"L0\", \"Muscle Length (L0)\", 1, 10, 5),\n    ui.input_slider(\"F0\", \"Muscle Force (F0)\", 1, 100, 50),\n    ui.input_slider(\"Vx\", \"Velocity Constant (Vx)\", 1, 10, 5),\n    ui.input_slider(\"af\", \"Activation Function (af)\", 0.1, 2.0, 1.0),\n    ui.input_slider(\"tau_a\", \"Activation Time Constant (tau_a)\", 1, 100, 50),\n    ui.input_slider(\"tau_d\", \"Deactivation Time Constant (tau_d)\", 1, 100, 50),\n    ui.input_action_button(\"optimize\", \"Run Optimization\"),  # Corrected button definition\n    \n    # Output elements for plot and table\n    ui.output_plot(\"musclePlot\"),\n    ui.output_table(\"muscleTable\")\n)\n\n# Define the Server logic\ndef server(input, output, session):\n    @output\n    @reactive.calc\n    def musclePlot():\n        if input.optimize():\n            results = thelen_muscle_opt(\n                onoff=(20, 75),\n                freq=input.frequency(),\n                excursion=input.excursion(),\n                L0=input.L0(),\n                F0=input.F0(),\n                Vx=input.Vx(),\n                af=input.af(),\n                tau_a=input.tau_a(),\n                tau_d=input.tau_d(),\n                path=\"a\"\n            )\n        else:\n            results = thelen_muscle(\n                onoff=(20, 75),\n                freq=input.frequency(),\n                excursion=input.excursion(),\n                L0=input.L0(),\n                F0=input.F0(),\n                Vx=input.Vx(),\n                af=input.af(),\n                tau_a=input.tau_a(),\n                tau_d=input.tau_d(),\n                path=\"a\"\n            )\n        \n        return results\n\n    @output\n    @reactive.calc\n    def muscleTable():\n        return {\n            \"Parameter\": [\"Onset\", \"Offset\", \"Excursion\"],\n            \"Value\": [20, 75, input.excursion()]\n        }\n\n# Define the App\napp = App(app_ui, server)\n\n", "type": "text"}, {"name": "fcn_thelen_muscle.py", "content": "\nimport numpy as np\n\ndef thelen_muscle(onoff, freq, excursion, L0, F0, Vx, af, tau_a, tau_d, path):\n    onset, offset = onoff\n    dt = 0.001 / freq\n    V0 = Vx * L0\n    penn0 = 0.087\n    w = L0 * np.sin(penn0)\n    \n    # Cycle time and position\n    t = np.arange(0, 1.25 / freq, dt)\n    position = excursion * np.sin(2 * np.pi * freq * t)\n    \n    return {\n        \"position\": position,\n        \"onset\": onset,\n        \"offset\": offset,\n        \"time\": t\n    }\n", "type": "text"}, {"name": "fcn_thelen_opt.py", "content": "\nimport numpy as np\nfrom fcn_thelen_muscle import thelen_muscle\n\ndef thelen_muscle_opt(onoff, freq, excursion, L0, F0, Vx, af, tau_a, tau_d, path):\n    # Set up optimization grid\n    on_range = np.arange(20, 26)\n    off_range = np.arange(26, 76)\n    opt = np.array(np.meshgrid(on_range, off_range)).T.reshape(-1, 2)\n    \n    # Calculate power for each combination\n    power = np.array([thelen_muscle(row, freq, excursion, L0, F0, Vx, af, tau_a, tau_d, path=\"b\") for row in opt])\n    \n    # Optimized solution\n    max_power_idx = np.argmax([p['position'].sum() for p in power])\n    opt_sln = np.append(opt[max_power_idx], power[max_power_idx])\n    \n    return thelen_muscle(opt_sln[:2], freq, excursion, L0, F0, Vx, af, tau_a, tau_d, \"a\")\n", "type": "text"}]